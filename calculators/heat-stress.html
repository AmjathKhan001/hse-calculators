<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Heat Stress Calculator | HSE Calculator</title>
    <meta name="description" content="Calculate heat stress risk, WBGT index, and work/rest schedules for hot environment safety.">
    <!-- Same head content -->
</head>
<body>
    <!-- Same header -->

    <section class="calculator-section">
        <div class="container">
            <h1 class="section-title">Heat Stress Calculator</h1>
            <p class="section-subtitle">Assess heat stress risk and determine safe work practices in hot environments.</p>
            
            <div class="calculator-form" id="heat-calculator-form">
                <div class="form-row">
                    <div class="form-group">
                        <label for="dry-bulb" class="form-label">Dry Bulb Temperature:</label>
                        <div class="input-group">
                            <input type="number" id="dry-bulb" class="form-control" min="-20" max="60" step="0.1" value="30">
                            <span class="input-group-text">°C</span>
                        </div>
                        <small class="form-text">Air temperature in shade</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="wet-bulb" class="form-label">Natural Wet Bulb Temperature:</label>
                        <div class="input-group">
                            <input type="number" id="wet-bulb" class="form-control" min="-20" max="60" step="0.1" value="25">
                            <span class="input-group-text">°C</span>
                        </div>
                        <small class="form-text">With natural air movement</small>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="globe-temperature" class="form-label">Globe Temperature:</label>
                        <div class="input-group">
                            <input type="number" id="globe-temperature" class="form-control" min="-20" max="100" step="0.1" value="35">
                            <span class="input-group-text">°C</span>
                        </div>
                        <small class="form-text">Radiant heat measurement</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="relative-humidity" class="form-label">Relative Humidity:</label>
                        <div class="input-group">
                            <input type="number" id="relative-humidity" class="form-control" min="0" max="100" step="1" value="60">
                            <span class="input-group-text">%</span>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="work-intensity" class="form-label">Work Intensity:</label>
                    <select id="work-intensity" class="form-control">
                        <option value="light">Light Work (up to 200 Watts)</option>
                        <option value="moderate" selected>Moderate Work (200-350 Watts)</option>
                        <option value="heavy">Heavy Work (350-500 Watts)</option>
                        <option value="very-heavy">Very Heavy Work (500+ Watts)</option>
                    </select>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="work-duration" class="form-label">Work Duration:</label>
                        <div class="input-group">
                            <input type="number" id="work-duration" class="form-control" min="0.25" max="8" step="0.25" value="1">
                            <span class="input-group-text">hours</span>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="clothing-type" class="form-label">Clothing Type:</label>
                        <select id="clothing-type" class="form-control">
                            <option value="light-summer">Light Summer Clothing (0.6 clo)</option>
                            <option value="work-uniform" selected>Work Uniform (1.0 clo)</option>
                            <option value="coveralls">Coveralls (1.2 clo)</option>
                            <option value="double-layer">Double Layer (1.5 clo)</option>
                            <option value="vapor-barrier">Vapor Barrier (2.0 clo)</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Additional Factors:</label>
                    <div class="checkbox-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="direct-sun" checked>
                            <span class="checkbox-text">Direct Sun Exposure</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="limited-airflow">
                            <span class="checkbox-text">Limited Air Movement</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="acclimatized">
                            <span class="checkbox-text">Workers Acclimatized</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="medical-risk">
                            <span class="checkbox-text">Medical Risk Factors</span>
                        </label>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="water-available" class="form-label">Water Availability:</label>
                    <select id="water-available" class="form-control">
                        <option value="unlimited">Unlimited - Easy access</option>
                        <option value="limited" selected>Limited - Accessible</option>
                        <option value="restricted">Restricted - Limited access</option>
                        <option value="none">None - No water available</option>
                    </select>
                </div>
                
                <button id="calculate-heat" class="btn btn-primary btn-lg">
                    <i class="fas fa-temperature-high"></i> Calculate Heat Stress
                </button>
                
                <div id="heat-result" class="result-box" style="display: none;">
                    <h3><i class="fas fa-thermometer-half"></i> Heat Stress Assessment</h3>
                    
                    <div class="result-summary">
                        <div class="summary-card" id="wbgt-card">
                            <div class="summary-icon">
                                <i class="fas fa-temperature-high"></i>
                            </div>
                            <div class="summary-content">
                                <h5>WBGT Index</h5>
                                <div class="summary-value" id="wbgt-value">0°C</div>
                            </div>
                        </div>
                        
                        <div class="summary-card" id="risk-card">
                            <div class="summary-icon">
                                <i class="fas fa-exclamation-triangle"></i>
                            </div>
                            <div class="summary-content">
                                <h5>Risk Level</h5>
                                <div class="summary-value" id="risk-level">Low</div>
                            </div>
                        </div>
                        
                        <div class="summary-card" id="hydration-card">
                            <div class="summary-icon">
                                <i class="fas fa-tint"></i>
                            </div>
                            <div class="summary-content">
                                <h5>Water Required</h5>
                                <div class="summary-value" id="water-required">0 L</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="work-rest-schedule mt-4">
                        <h5><i class="fas fa-clock"></i> Recommended Work/Rest Schedule</h5>
                        <div id="work-rest-chart"></div>
                    </div>
                    
                    <div class="heat-details mt-4">
                        <h5><i class="fas fa-info-circle"></i> Heat Stress Details</h5>
                        <div class="details-grid" id="heat-details"></div>
                    </div>
                    
                    <div class="recommendations mt-4">
                        <h5><i class="fas fa-lightbulb"></i> Safety Recommendations</h5>
                        <div id="heat-recommendations"></div>
                    </div>
                    
                    <div class="print-actions mt-4">
                        <button class="btn btn-primary print-btn" onclick="generatePDF('heat-calculator-form', 'heat-stress')">
                            <i class="fas fa-file-pdf"></i> Save as PDF Report
                        </button>
                        <button class="btn btn-secondary" onclick="window.print()">
                            <i class="fas fa-print"></i> Print
                        </button>
                    </div>
                </div>
                
                <div class="calculator-info mt-4">
                    <h4><i class="fas fa-info-circle"></i> Heat Stress Guidelines</h4>
                    
                    <div class="wbgt-limits-table">
                        <h5>ACGIH TLVs for Heat Stress (WBGT in °C)</h5>
                        <table class="risk-matrix">
                            <thead>
                                <tr>
                                    <th>Workload</th>
                                    <th>Acclimatized</th>
                                    <th>Not Acclimatized</th>
                                    <th>Action Required</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Light</td>
                                    <td>30.0</td>
                                    <td>28.0</td>
                                    <td>Caution - Increased monitoring</td>
                                </tr>
                                <tr>
                                    <td>Moderate</td>
                                    <td>27.5</td>
                                    <td>25.0</td>
                                    <td>Extra breaks, hydration</td>
                                </tr>
                                <tr>
                                    <td>Heavy</td>
                                    <td>26.0</td>
                                    <td>22.5</td>
                                    <td>Work/Rest cycles required</td>
                                </tr>
                                <tr>
                                    <td>Very Heavy</td>
                                    <td>25.0</td>
                                    <td>20.0</td>
                                    <td>Consider stopping work</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="heat-illness-table mt-4">
                        <h5><i class="fas fa-heartbeat"></i> Heat Illness Symptoms</h5>
                        <table class="risk-matrix">
                            <thead>
                                <tr>
                                    <th>Condition</th>
                                    <th>WBGT Range</th>
                                    <th>Symptoms</th>
                                    <th>First Aid</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Heat Rash</td>
                                    <td>Any</td>
                                    <td>Red clusters of small blisters</td>
                                    <td>Keep skin dry, powder</td>
                                </tr>
                                <tr>
                                    <td>Heat Cramps</td>
                                    <td>26-30°C</td>
                                    <td>Muscle pain/spasms</td>
                                    <td>Rest, cool water, stretching</td>
                                </tr>
                                <tr>
                                    <td>Heat Exhaustion</td>
                                    <td>28-32°C</td>
                                    <td>Heavy sweating, dizziness</td>
                                    <td>Cool area, water, medical</td>
                                </tr>
                                <tr>
                                    <td>Heat Stroke</td>
                                    <td>30°C+</td>
                                    <td>No sweating, confusion</td>
                                    <td>EMERGENCY - Call 911</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Social Sharing & Related Calculators -->
            <!-- Same as previous -->
            
        </div>
    </section>

    <!-- Footer -->
    <!-- Same as previous -->

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('calculate-heat').addEventListener('click', calculateHeatStress);
        });

        function calculateHeatStress() {
            // Get input values
            const dryBulb = parseFloat(document.getElementById('dry-bulb').value);
            const wetBulb = parseFloat(document.getElementById('wet-bulb').value);
            const globeTemp = parseFloat(document.getElementById('globe-temperature').value);
            const humidity = parseFloat(document.getElementById('relative-humidity').value);
            const workIntensity = document.getElementById('work-intensity').value;
            const workDuration = parseFloat(document.getElementById('work-duration').value);
            const clothingType = document.getElementById('clothing-type').value;
            const waterAvailable = document.getElementById('water-available').value;
            
            // Get checkboxes
            const directSun = document.getElementById('direct-sun').checked;
            const limitedAirflow = document.getElementById('limited-airflow').checked;
            const acclimatized = document.getElementById('acclimatized').checked;
            const medicalRisk = document.getElementById('medical-risk').checked;
            
            // Calculate WBGT
            const wbgt = calculateWBGT(dryBulb, wetBulb, globeTemp);
            
            // Calculate heat stress index
            const heatIndex = calculateHeatIndex(dryBulb, humidity);
            
            // Determine work/rest schedule
            const workRest = calculateWorkRestSchedule(wbgt, workIntensity, acclimatized);
            
            // Calculate hydration requirements
            const hydration = calculateHydration(wbgt, workIntensity, workDuration);
            
            // Assess risk level
            const riskAssessment = assessHeatRisk(wbgt, workIntensity, acclimatized, medicalRisk);
            
            // Display results
            displayHeatResults({
                dryBulb,
                wetBulb,
                globeTemp,
                humidity,
                workIntensity,
                workDuration,
                clothingType,
                waterAvailable,
                directSun,
                limitedAirflow,
                acclimatized,
                medicalRisk,
                wbgt,
                heatIndex,
                workRest,
                hydration,
                riskAssessment
            });
            
            document.getElementById('heat-result').style.display = 'block';
        }

        function calculateWBGT(dryBulb, wetBulb, globeTemp) {
            // Simplified WBGT calculation
            // WBGT = 0.7 × Wet Bulb + 0.2 × Globe Temp + 0.1 × Dry Bulb
            return (0.7 * wetBulb) + (0.2 * globeTemp) + (0.1 * dryBulb);
        }

        function calculateHeatIndex(temperature, humidity) {
            // Simplified heat index calculation
            if (temperature < 27) return temperature;
            
            const T = temperature;
            const R = humidity;
            
            // Simplified formula
            let heatIndex = -8.78469475556;
            heatIndex += 1.61139411 * T;
            heatIndex += 2.33854883889 * R;
            heatIndex += -0.14611605 * T * R;
            heatIndex += -0.012308094 * T * T;
            heatIndex += -0.0164248277778 * R * R;
            heatIndex += 0.002211732 * T * T * R;
            heatIndex += 0.00072546 * T * R * R;
            heatIndex += -0.000003582 * T * T * R * R;
            
            return heatIndex;
        }

        function calculateWorkRestSchedule(wbgt, workIntensity, acclimatized) {
            // Determine work/rest percentages based on ACGIH guidelines
            let workPercentage = 100;
            let restPercentage = 0;
            let cycleLength = 60; // minutes
            
            // Work intensity multipliers
            const intensityFactors = {
                'light': 1.0,
                'moderate': 0.8,
                'heavy': 0.6,
                'very-heavy': 0.4
            };
            
            const factor = intensityFactors[workIntensity] || 1.0;
            
            // Acclimatization adjustment
            const acclimatizationFactor = acclimatized ? 1.1 : 1.0;
            
            // Calculate work/rest ratio
            if (wbgt < 25) {
                workPercentage = 100;
                restPercentage = 0;
            } else if (wbgt < 27) {
                workPercentage = 75 * factor * acclimatizationFactor;
                restPercentage = 25;
                cycleLength = 45;
            } else if (wbgt < 29) {
                workPercentage = 50 * factor * acclimatizationFactor;
                restPercentage = 50;
                cycleLength = 30;
            } else if (wbgt < 31) {
                workPercentage = 25 * factor * acclimatizationFactor;
                restPercentage = 75;
                cycleLength = 20;
            } else {
                workPercentage = 0;
                restPercentage = 100;
                cycleLength = 0;
            }
            
            return {
                workPercentage: Math.min(workPercentage, 100),
                restPercentage: Math.max(restPercentage, 0),
                cycleLength: cycleLength,
                cyclesPerHour: cycleLength > 0 ? 60 / cycleLength : 0
            };
        }

        function calculateHydration(wbgt, workIntensity, workDuration) {
            // Base water requirements in liters per hour
            const baseRates = {
                'light': 0.5,
                'moderate': 0.75,
                'heavy': 1.0,
                'very-heavy': 1.5
            };
            
            let rate = baseRates[workIntensity] || 0.5;
            
            // Adjust for WBGT
            if (wbgt > 30) rate *= 1.5;
            else if (wbgt > 27) rate *= 1.25;
            else if (wbgt > 24) rate *= 1.1;
            
            const totalWater = rate * workDuration;
            const frequency = Math.max(Math.ceil(workDuration * 4), 4); // At least every 15 mins
            
            return {
                hourlyRate: rate,
                totalWater: totalWater,
                frequency: frequency,
                perBreak: totalWater / frequency
            };
        }

        function assessHeatRisk(wbgt, workIntensity, acclimatized, medicalRisk) {
            // ACGIH TLV thresholds
            const thresholds = {
                'light': acclimatized ? 30.0 : 28.0,
                'moderate': acclimatized ? 27.5 : 25.0,
                'heavy': acclimatized ? 26.0 : 22.5,
                'very-heavy': acclimatized ? 25.0 : 20.0
            };
            
            const threshold = thresholds[workIntensity] || 30.0;
            const margin = threshold - wbgt;
            
            let riskLevel, colorClass, recommendations = [];
            
            if (margin > 5) {
                riskLevel = 'Low';
                colorClass = 'status-low';
                recommendations = [
                    'Normal work routine acceptable',
                    'Provide water access',
                    'Monitor for heat illness symptoms'
                ];
            } else if (margin > 2) {
                riskLevel = 'Moderate';
                colorClass = 'status-moderate';
                recommendations = [
                    'Increase water breaks',
                    'Provide shade areas',
                    'Monitor workers closely',
                    'Implement buddy system'
                ];
            } else if (margin > 0) {
                riskLevel = 'High';
                colorClass = 'status-high';
                recommendations = [
                    'Implement work/rest schedule',
                    'Provide cooling stations',
                    'Use engineering controls',
                    'Increase supervision'
                ];
            } else if (margin > -2) {
                riskLevel = 'Very High';
                colorClass = 'status-very-high';
                recommendations = [
                    'Reduce work intensity',
                    'Implement mandatory breaks',
                    'Consider administrative controls',
                    'Provide medical monitoring'
                ];
            } else {
                riskLevel = 'Extreme';
                colorClass = 'status-extreme';
                recommendations = [
                    'STOP WORK IMMEDIATELY',
                    'Move to cool area',
                    'Provide emergency cooling',
                    'Seek medical attention if needed'
                ];
            }
            
            // Add medical risk warnings
            if (medicalRisk) {
                riskLevel = riskLevel === 'Low' ? 'Moderate' : 
                           riskLevel === 'Moderate' ? 'High' : 
                           riskLevel === 'High' ? 'Very High' : riskLevel;
                recommendations.push('Extra caution for workers with medical conditions');
                recommendations.push('Implement individual risk assessments');
            }
            
            // General recommendations
            recommendations.push('Train workers on heat illness recognition');
            recommendations.push('Establish emergency response procedures');
            recommendations.push('Use personal cooling devices if available');
            
            return {
                riskLevel: riskLevel,
                colorClass: colorClass,
                margin: margin,
                threshold: threshold,
                recommendations: recommendations
            };
        }

        function displayHeatResults(data) {
            // Update summary cards
            document.getElementById('wbgt-value').textContent = `${data.wbgt.toFixed(1)}°C`;
            document.getElementById('risk-level').textContent = data.riskAssessment.riskLevel;
            document.getElementById('water-required').textContent = `${data.hydration.totalWater.toFixed(1)} L`;
            
            // Update card colors
            document.getElementById('wbgt-card').className = `summary-card ${data.riskAssessment.colorClass}`;
            document.getElementById('risk-card').className = `summary-card ${data.riskAssessment.colorClass}`;
            document.getElementById('hydration-card').className = `summary-card ${data.waterAvailable === 'none' ? 'status-high' : 'status-low'}`;
            
            // Display work/rest schedule
            const chartHtml = `
                <div class="work-rest-chart">
                    <div class="chart-title">Recommended Schedule (${data.workRest.cycleLength}-minute cycles)</div>
                    <div class="chart-bar">
                        <div class="work-segment" style="width: ${data.workRest.workPercentage}%">
                            <span class="segment-label">Work: ${Math.round(data.workRest.workPercentage)}%</span>
                        </div>
                        <div class="rest-segment" style="width: ${data.workRest.restPercentage}%">
                            <span class="segment-label">Rest: ${Math.round(data.workRest.restPercentage)}%</span>
                        </div>
                    </div>
                    <div class="chart-details">
                        <div class="detail-item">
                            <i class="fas fa-clock"></i>
                            <span>Work cycles: ${data.workRest.cyclesPerHour.toFixed(1)} per hour</span>
                        </div>
                        <div class="detail-item">
                            <i class="fas fa-stopwatch"></i>
                            <span>Work duration: ${(data.workRest.cycleLength * data.workRest.workPercentage / 100).toFixed(0)} minutes per cycle</span>
                        </div>
                        <div class="detail-item">
                            <i class="fas fa-couch"></i>
                            <span>Rest duration: ${(data.workRest.cycleLength * data.workRest.restPercentage / 100).toFixed(0)} minutes per cycle</span>
                        </div>
                    </div>
                </div>
            `;
            document.getElementById('work-rest-chart').innerHTML = chartHtml;
            
            // Display heat details
            const detailsHtml = `
                <div class="detail-item">
                    <div class="detail-label">WBGT Index:</div>
                    <div class="detail-value">${data.wbgt.toFixed(1)}°C</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Heat Index:</div>
                    <div class="detail-value">${data.heatIndex.toFixed(1)}°C</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Relative Humidity:</div>
                    <div class="detail-value">${data.humidity}%</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Work Intensity:</div>
                    <div class="detail-value">${data.workIntensity.replace('-', ' ').toUpperCase()}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Clothing Insulation:</div>
                    <div class="detail-value">${getClothingValue(data.clothingType)} clo</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Acclimatization:</div>
                    <div class="detail-value">${data.acclimatized ? 'Yes' : 'No'}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">TLV Threshold:</div>
                    <div class="detail-value">${data.riskAssessment.threshold.toFixed(1)}°C</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Margin to TLV:</div>
                    <div class="detail-value ${data.riskAssessment.margin > 0 ? 'positive' : 'negative'}">
                        ${Math.abs(data.riskAssessment.margin).toFixed(1)}°C ${data.riskAssessment.margin > 0 ? 'below' : 'above'}
                    </div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Water Required/Hour:</div>
                    <div class="detail-value">${data.hydration.hourlyRate.toFixed(1)} L</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Drink Frequency:</div>
                    <div class="detail-value">Every ${Math.round(60/data.hydration.frequency)} minutes</div>
                </div>
            `;
            document.getElementById('heat-details').innerHTML = detailsHtml;
            
            // Display recommendations
            const recList = document.getElementById('heat-recommendations');
            recList.innerHTML = '';
            
            data.riskAssessment.recommendations.forEach(rec => {
                const div = document.createElement('div');
                div.className = 'recommendation-item';
                const isCritical = rec.includes('STOP WORK');
                div.innerHTML = `
                    <i class="fas ${isCritical ? 'fa-exclamation-triangle' : 'fa-check-circle'}"></i>
                    <span>${rec}</span>
                `;
                recList.appendChild(div);
            });
        }

        function getClothingValue(clothingType) {
            const values = {
                'light-summer': 0.6,
                'work-uniform': 1.0,
                'coveralls': 1.2,
                'double-layer': 1.5,
                'vapor-barrier': 2.0
            };
            return values[clothingType] || 1.0;
        }

        function generatePDF(elementId, filename) {
            const element = document.getElementById(elementId);
            
            const opt = {
                margin: 0.5,
                filename: `${filename}-${new Date().getTime()}.pdf`,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' }
            };
            
            html2pdf().set(opt).from(element).save();
        }
    </script>
</body>
</html>
